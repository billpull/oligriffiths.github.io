<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Eat your greens! A beginners guide to Broccoli.js | Oli Griffiths</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Welcome to the world of Broccoli.js. So, I’m sure you’re wondering, what is Broccoli.js? Well, per the Broccoli.js website  The asset pipeline for ambitious applications  Cool, wait, what the hell doe">
<meta name="keywords" content="javascript,broccoli">
<meta property="og:type" content="article">
<meta property="og:title" content="Eat your greens! A beginners guide to Broccoli.js">
<meta property="og:url" content="http://www.oligriffiths.com/2017/01/26/Eat-your-greens-A-beginners-guide-to-Broccoli-js/index.html">
<meta property="og:site_name" content="Oli Griffiths">
<meta property="og:description" content="Welcome to the world of Broccoli.js. So, I’m sure you’re wondering, what is Broccoli.js? Well, per the Broccoli.js website  The asset pipeline for ambitious applications  Cool, wait, what the hell doe">
<meta property="og:updated_time" content="2017-06-14T18:02:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eat your greens! A beginners guide to Broccoli.js">
<meta name="twitter:description" content="Welcome to the world of Broccoli.js. So, I’m sure you’re wondering, what is Broccoli.js? Well, per the Broccoli.js website  The asset pipeline for ambitious applications  Cool, wait, what the hell doe">
  
    <link rel="alternative" href="/atom.xml" title="Oli Griffiths" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='http://fonts.googleapis.com/css?family=Lato:300,700' rel='stylesheet' type='text/css'>
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-54750852-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body class="not-home">
  <div id="container">
    <div id="header-nav" class="">
    <div class="outer">
        <nav id="main-nav">
            <a id="main-nav-toggle" class="nav-icon"></a>
            
            <a class="main-nav-link" href="/">Home</a>
            
            <a class="main-nav-link" href="/archives">Archives</a>
            
            <a class="main-nav-link" href="/about">About</a>
            
        </nav>
        <nav id="sub-nav">
            
            <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        </nav>
        <div id="search-form-wrap">
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.oligriffiths.com"></form>
        </div>
    </div>
</div>


    <div id="wrap">
        
        <div id="content">
          <div class="outer">
            <section id="main"><article id="post-Eat-your-greens-A-beginners-guide-to-Broccoli-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/26/Eat-your-greens-A-beginners-guide-to-Broccoli-js/" class="article-date">
  <time datetime="2017-01-26T21:17:54.000Z" itemprop="datePublished">Jan 26 2017</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Eat your greens! A beginners guide to Broccoli.js
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to the world of Broccoli.js. So, I’m sure you’re wondering, what <em>is</em> Broccoli.js?</p>
<p>Well, per the <a href="http://broccolijs.com" target="_blank" rel="external">Broccoli.js website</a></p>
<blockquote>
<p>The asset pipeline for ambitious applications</p>
</blockquote>
<p>Cool, wait, what the hell does that mean? </p>
<a id="more"></a>
<p>“Ambitious applications”? That sounds scary, I just wanna make a<br>simple JS app, with ES6 transpilation, SCSS pre-processing, asset concatenation, live reload, uglification,<br>vendor npm module inclusion, developement server, and, oh, wait, perhaps it’s ambitious. </p>
<p>Oh, yeah, and I want all that to be fast.</p>
<p>Historically, we had grunt, and decided we didn’t like configuration files.<br>Then we had gulp, because we wanted to write code to compile our code, then it got slow.<br>Then we had webpack that does bundling, minifaction, source maps, but, it’s kinda hard to configure.</p>
<h2 id="Follow-along"><a href="#Follow-along" class="headerlink" title="Follow along"></a>Follow along</h2><p>here’s a talk I gave at EmberNYC meetup in Jan 2017 that covers most of this article.</p>
<div style="padding-bottom: 56%; position: relative"><iframe style="position: absolute; width: 100%; height: 100%;" src="https://www.youtube.com/embed/JTzvYJBxwyI?start=141&end=1377" frameborder="0" allowfullscreen></iframe></div>

<h2 id="Enter-Broccoli-js"><a href="#Enter-Broccoli-js" class="headerlink" title="Enter Broccoli.js."></a>Enter Broccoli.js.</h2><p>So, how is Broccoli any different. Well, all the aforementioned tools work on the basis of running commands on<br>a set of files, usually applied through some kind of <code>glob()</code> type file finder, perhaps writing to temp files<br>post processing, and ultimately working on files/streams directly. Broccoli on the other hand works on the<br>concept of <code>trees</code>.</p>
<h3 id="What-is-a-tree"><a href="#What-is-a-tree" class="headerlink" title="What is a tree?"></a>What is a tree?</h3><p>A Broccoli tree can be thought of much like a file system tree. Think of a directory, that contains files, and<br>directories, that also contains files, and so on, much like the branches of a tree. </p>
<p>Trees can then be manipulated via various broccoli plugins, to do things like copy files to the destination<br>directory, pre-process files within a tree and convert them from one format to another (e.g. .scss to .css),<br>merge trees together (think rsync’ing one directory into another), concatenate files of a certain type into<br>one (bundling), uglifying, and so on.</p>
<h3 id="How-do-trees-work"><a href="#How-do-trees-work" class="headerlink" title="How do trees work?"></a>How do trees work?</h3><p>Trees themselves don’t actually contain file contents, and manipulations to the trees don’t happen when you<br>create or change them. They’re essentially representations of state, once all declared manipulations have been<br>done on the tree, it gets processed, and at this point, the files are actually read and operations performed.<br>This means that the setup for the trees and the operations that will be performed are very fast.</p>
<p>Additionally, when files are changed, Broccoli only needs to rebuild certain trees and not the entire<br>application, this makes rebuilds <em>crazy</em> fast. Additionally, trees can be cached for extra speeds.</p>
<p>For example, say you only change an image that is just being copied verbatim from a source directory to the<br>target directory, only that specific subtree needs to be re-built, however javascript doesn’t need to be<br>compiled, scss files don’t need to be parsed, etc.</p>
<p>It sounds like a lot, but it’s actually quite simple, so let’s get started with a simple Broccoli app.</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup:"></a>Setup:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mkdir broccoli-demo</div><div class="line">cd broccoli-demo</div><div class="line">npm install -g broccoli-cli</div><div class="line">npm init</div><div class="line">npm install --save-dev broccoli</div><div class="line">mkdir app</div><div class="line">touch Brocfile.js</div><div class="line">echo &apos;hello world&apos; &gt; app/index.html</div></pre></td></tr></table></figure>
<p>This is the basic setup for our broccoli app. We’ve installed the broccoli CLI tool, this will actually build our<br>application, and provide a built in express local development server.</p>
<p>The Brocfile.js will contain all our build instructions, and the <code>app</code> directory will contain our source files.</p>
<p>We’ve started with the simplest of apps, an index.html file with “hello world” in it. (This is the echo line above).</p>
<p>Next, we’ll start building out our Brocfile.js to add some basic build instructions.</p>
<h2 id="Copying-files"><a href="#Copying-files" class="headerlink" title="Copying files"></a>Copying files</h2><p>Now, let’s perform a simple copy operation, copying our index.html from out app directory to the destination.<br>This is done via a broccoli filter called <a href="https://github.com/broccolijs/broccoli-funnel" target="_blank" rel="external">broccoli-funnel</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-funnel</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span>   : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = html;</div></pre></td></tr></table></figure>
<p>What we’re doing here should be fairly self explanatory, although the “funnel” bit seems a bit misleading. </p>
<p>Per the docs:</p>
<blockquote>
<p>The funnel plugin takes an input node, and returns a new node with only a subset of the files from the input<br>node. The files can be moved to different paths. You can use regular expressions to select which files to include<br>or exclude.</p>
</blockquote>
<p>Basically, this is taking an input node, which can be a string representing a directory or another tree,<br>selecting only the <code>index.html</code> file (this can be a regex match also) and moving it to the <code>destDir</code>, the root.</p>
<p>Finally, we return the tree as the module export, and Broccoli handles all the rest.</p>
<p>The Broccoli CLI tool allows you to build the application as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">broccoli build [target directory]</div></pre></td></tr></table></figure>
<p>Where <code>[target directory]</code> is an output directory of your choosing. We will use <code>dist</code> going forwards.</p>
<p>Cool, let’s try running this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">broccoli build dist</div></pre></td></tr></table></figure>
<p>Assuming no errors are output, your <code>dist</code> directory should look like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index.html</div></pre></td></tr></table></figure>
<p>Simple.</p>
<p>Note: when re-running the build command, you must remove the existing target directory [<code>dist</code>];</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -rf dist &amp;&amp; broccoli build dist</div></pre></td></tr></table></figure>
<p>In order to make this simpler going forwards, let’s add a build script to our <code>package.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"build"</span>: <span class="string">"rm -rf dist &amp;&amp; broccoli build dist"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now you can simply run <code>npm run build</code> to generate a new build.</p>
<h2 id="Built-in-build-server"><a href="#Built-in-build-server" class="headerlink" title="Built in build server"></a>Built in build server</h2><p>Broccoli comes with a built in build server, that watches files and will rebuild trees as appropriate.<br>To use it, simply:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">broccoli serve</div></pre></td></tr></table></figure>
<p>Open a browser and point to:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:4200</div></pre></td></tr></table></figure>
<p>And you should see your “Hello World” HTML page rendered. Try changing the content of the <code>index.html</code> file, you<br>should see Broccoli rebuild once you save the file, and output the build time for each of the slowest trees it built<br>(there’s only one right now). Once it’s rebuilt, refresh your browser to see your changes.</p>
<p>Well done, you’ve now built your first Broccoli powered app!</p>
<p>Let’s add an npm script to run the serve command to your <code>package.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"build"</span>: <span class="string">"rm -rf dist &amp;&amp; broccoli build dist"</span>,</div><div class="line">    <span class="attr">"serve"</span>: <span class="string">"broccoli serve"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note:"></a>Note:</h3><p>From now on, I will refer to running the build command, and the serve command as <code>npm run build</code> and <code>npm run serve</code><br>to keep things short.</p>
<p>When I say <code>build &amp; serve</code> this is an alias for <code>npm run build &amp;&amp; npm run serve</code>.</p>
<p>I will assume you know to refresh the browser on <code>localhost:4200</code> when serving.</p>
<h2 id="Multiple-trees"><a href="#Multiple-trees" class="headerlink" title="Multiple trees"></a>Multiple trees</h2><p>The first example is fairly contrived and not that useful. We’ll want to be able to work with multiple trees, and<br>ultimately have them written to our target directory.</p>
<p>Introducing, <a href="https://github.com/broccolijs/broccoli-merge-trees" target="_blank" rel="external">broccoli-merge-trees</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-merge-trees</div></pre></td></tr></table></figure>
<p>Now let’s add a JS and a CSS file that’ll be the root of our web app and copy that into an <code>assets</code> folder.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir app/styles</div><div class="line">touch app/styles/app.css</div><div class="line">touch app/app.js</div></pre></td></tr></table></figure>
<p>In <code>app/styles/app.css</code> put:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span>&#123;</div><div class="line">    <span class="attribute">background</span>: palegreen;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>In <code>app/app.js</code> put:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alert(<span class="string">"Eat your greens"</span>);</div></pre></td></tr></table></figure></p>
<p>In <code>app/index.html</code> put:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!doctype html&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/assets/app.css"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">hello world</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/assets/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy JS file into assets</span></div><div class="line"><span class="keyword">const</span> js = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'app.js'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/assets'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy CSS file into assets</span></div><div class="line"><span class="keyword">const</span> css = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">srcDir</span>: <span class="string">'styles'</span>,</div><div class="line">  <span class="attr">files</span> : [<span class="string">'app.css'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/assets'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = merge([html, js, css]);</div></pre></td></tr></table></figure>
<p>Again, pretty simple. We’ve added 2 more trees, a <code>js</code> tree and a <code>css</code>, that’s taken an input node <code>appRoot</code>,<br>filtered out all files except the <code>app.js</code> and <code>app.css</code> and will copy the files to the <code>destDir</code> of <code>/assets</code><br>within the target directory. Then, we take all trees, and merge them together, so all files end up in the<br>target directory.</p>
<p>Now <code>build &amp; serve</code>, you should get an alert message saying <code>Eat your greens</code> with a nice pale green background.</p>
<p>The target <code>dist</code> directory should contain:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">assets/app.js</div><div class="line">assets/app.css</div><div class="line">index.html</div></pre></td></tr></table></figure>
<h2 id="SCSS-Preprocessing"><a href="#SCSS-Preprocessing" class="headerlink" title="SCSS Preprocessing"></a>SCSS Preprocessing</h2><p>So our app is coming along, we have an index page that loads a javascript file and a lovely green background.<br>But css is so old school, we want to be able to write some fancy scss and have a preprocessor convert that to<br>css for us.</p>
<p>For the purposes of this tutorial, I am going to use SCSS, however there are sass, less and other preprocessors<br>available to use in a Broccoli build. Check NPM.</p>
<p>For this, we will use the excellent <a href="https://github.com/aexmachina/broccoli-sass-source-maps" target="_blank" rel="external">broccoli-sass-source-maps</a><br>plugin.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-sass-source-maps</div><div class="line">mv app/styles/app.css app/styles/app.scss</div></pre></td></tr></table></figure>
<p>In <code>app/styles/app.scss</code> put:<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$body-color</span>: palegreen;</div><div class="line"><span class="selector-tag">html</span>&#123;</div><div class="line">  <span class="attribute">background</span>: <span class="variable">$body-color</span>;</div><div class="line">  <span class="attribute">border</span>: <span class="number">5px</span> solid green;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"><span class="keyword">const</span> compileSass = <span class="built_in">require</span>(<span class="string">'broccoli-sass-source-maps'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy JS file into assets</span></div><div class="line"><span class="keyword">const</span> js = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'app.js'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/assets'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy SCSS file into assets</span></div><div class="line"><span class="keyword">const</span> css = compileSass(</div><div class="line">  [appRoot],</div><div class="line">  <span class="string">'styles/app.scss'</span>,</div><div class="line">  <span class="string">'assets/app.css'</span>,</div><div class="line">  &#123;&#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = merge([html, js, css]);</div></pre></td></tr></table></figure>
<p>As you can see, we’re now using the <code>compileSass</code> plugin to transform our <code>scss</code> file into a <code>css</code> file, and<br>emit it into the <code>/assets</code> directory. The last parameter is an options hash that we will cover in a moment.</p>
<p>Now <code>build &amp; serve</code> and you should see the newly compiled <code>scss</code> file has generated a <code>css</code> file with the addition<br>of the green border on the <code>html</code> element. Pretty neat. You can now use this <code>app/styles/app.scss</code> file as your<br>entrypoint for scss/sass compilation.</p>
<h3 id="Source-maps"><a href="#Source-maps" class="headerlink" title="Source maps"></a>Source maps</h3><p>As the name of the plugin suggests, it supports source maps. Source maps are a great way during development<br>to be able see where styles have come from in the source <code>scss</code> document, rather than the compiled <code>css</code> document.</p>
<p>Try inspecting the html tag right now, you should see the <code>html</code> style is defined in <code>app.css</code> on line 1, however<br>it’s actually defined in the <code>app.scss</code> on line 2. This is a fairly trivial example but gets way complicated<br>when you have imported files and lots of scss processing being done.</p>
<p>To enable source maps, add the following to the options hash that’s the last parameter to <code>compileSass()</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">const</span> css = compileSass(</div><div class="line">  [appRoot],</div><div class="line">  <span class="string">'styles/app.scss'</span>,</div><div class="line">  <span class="string">'assets/app.css'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">sourceMap</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapEmbed</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapContents</span>: <span class="literal">true</span>,</div><div class="line">  &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>Now <code>build &amp; serve</code> and you should see that when inspecting the html tag, the line has changed to line 2 and the<br>file is now <code>app.scss</code>. If you click the file name in the inspector, it should take you to the source <code>app.scss</code><br>file, showing the original scss, complete with variables.</p>
<p>See the Github repo for more details on further configuration options.</p>
<h2 id="ES6-Transpilation"><a href="#ES6-Transpilation" class="headerlink" title="ES6 Transpilation"></a>ES6 Transpilation</h2><p>So, our javascript is just your run-of-the-mill, runs in the browser, ES5, boring old javascript. But we’re making<br>a shiny new, state-of-the-art javascript application, so we should really be pushing the latest and greatest ES6<br>syntax. Step up <a href="https://babeljs.io" target="_blank" rel="external">Babel</a>.</p>
<p><code>Babel</code> is a javascript compiler. It will transpile (convert from one format to another), ES6 syntax javascript, to<br>ES5 syntax javascript that is runnable in the browser. For this, we will require<br><a href="https://github.com/babel/broccoli-babel-transpiler" target="_blank" rel="external">broccoli-babel-transpiler</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-babel-transpiler</div></pre></td></tr></table></figure>
<p>Now open <code>app/app.js</code> and set the contents to:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/app.js</span></div><div class="line"><span class="keyword">const</span> message = <span class="string">'Eat your greens'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        alert(message);</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> foo();</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"><span class="keyword">const</span> compileSass = <span class="built_in">require</span>(<span class="string">'broccoli-sass-source-maps'</span>);</div><div class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy JS file into assets</span></div><div class="line"><span class="keyword">let</span> js = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'app.js'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/assets'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Transpile JS files to ES5</span></div><div class="line">js = babel(js, &#123; </div><div class="line">  <span class="attr">browserPolyfill</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">sourceMap</span>: <span class="string">'inline'</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy CSS file into assets</span></div><div class="line"><span class="keyword">const</span> css = compileSass(</div><div class="line">  [appRoot],</div><div class="line">  <span class="string">'styles/app.scss'</span>,</div><div class="line">  <span class="string">'assets/app.css'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">sourceMap</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapEmbed</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapContents</span>: <span class="literal">true</span>,</div><div class="line">  &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = merge([html, js, css]);</div></pre></td></tr></table></figure>
<p>So what’s happening here? First off, we’ve declared <code>js</code> as a mutable variable (<code>let</code>) rather than an immutable<br>variable (<code>cosnt</code>) so we can re-assign it. Next, we pass the <code>js</code> tree into the babel transpiler, this will<br>transpile the ES6 syntax to ES5.</p>
<p>If you <code>build</code> this now, and open <code>dist/assets/app.js</code>, you should see:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// dist/assets/app.js</span></div><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> message = <span class="string">'Eat your greens'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        alert(message);</div><div class="line">        <span class="built_in">console</span>.log(_this);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> foo();</div><div class="line"><span class="comment">//# sourceMappingURL=...</span></div></pre></td></tr></table></figure>
<p>So, a few things have happened here:</p>
<ul>
<li><code>const</code> has been changed to <code>var</code></li>
<li>The arrow function <code>() =&gt; {}</code> inside the setTimeout has been converted to a regular function.</li>
<li>The use of <code>this</code> within the arrow function refers to the correct <code>this</code> context.</li>
<li>You should also notice the sourcemap at the bottom</li>
</ul>
<p>If you run this in the browser, you’ll see the alert and the correct <code>this</code> is logged to the console.</p>
<p>Now try adding a <code>debugger;</code> statement into the function and notice that the console stops at the breakpoint.<br>The presented source code should be the original ES6 version, <em>not</em> the transpiled ES5 version.</p>
<h2 id="JS-imports"><a href="#JS-imports" class="headerlink" title="JS imports"></a>JS imports</h2><p>ES6 allows you to import code from other Javascript files using the following syntax:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">'./foo'</span>;</div></pre></td></tr></table></figure>
<p>Try creating a file <code>app/foo.js</code> with the contents:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/foo.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> bar = <span class="string">'bar'</span>;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'foo'</span>;</div></pre></td></tr></table></figure>
<p>and set the contents of <code>app/app.js</code> to:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/app.js</span></div><div class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">'./foo'</span>;</div><div class="line"><span class="keyword">import</span> bar <span class="keyword">from</span> <span class="string">'./foo'</span>;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(foo);</div></pre></td></tr></table></figure>
<p>Now <code>build &amp; serve</code>, refresh the browser, and:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">app.js:5 Uncaught ReferenceError: require is not defined</div><div class="line">    at app.js:5</div></pre></td></tr></table></figure>
<p>Uh oh, what’s going on? Well, babel will transpile ES6 to ES5, however <code>import</code> statements are converted to<br>node compatible <code>require()</code> AMD calls. The browser doesn’t have a mechanism for resolving <code>require()</code> calls by default<br>so we need a way of handling this. There are a couple of solutions for this.</p>
<ul>
<li>Browserify via <code>broccoli-watchify</code></li>
<li>Requirejs via <code>broccoli-requirejs</code></li>
<li>Rollup via <code>broccoli-rollup</code></li>
</ul>
<p>We’re going to focus on <a href="http://rollupjs.org/" target="_blank" rel="external">Rollup</a> here because aside from module loading, it has some fairly<br>cool other features we will touch on.</p>
<p>Here’s what the website says:</p>
<blockquote>
<p>Rollup is a next-generation JavaScript module bundler. Author your app or library using ES2015 modules, then<br>efficiently bundle them up into a single file for use in browsers and Node.js</p>
</blockquote>
<p>So, first off, install rollup:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-rollup</div></pre></td></tr></table></figure>
<p>And set your <code>Broccoli.js</code> file to:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"><span class="keyword">const</span> compileSass = <span class="built_in">require</span>(<span class="string">'broccoli-sass-source-maps'</span>);</div><div class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line"><span class="keyword">const</span> Rollup = <span class="built_in">require</span>(<span class="string">'broccoli-rollup'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Rollup dependencies</span></div><div class="line"><span class="keyword">let</span> js = <span class="keyword">new</span> Rollup(appRoot, &#123;</div><div class="line">  <span class="attr">inputFiles</span>: [<span class="string">'**/*.js'</span>],</div><div class="line">  <span class="attr">rollup</span>: &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'app.js'</span>,</div><div class="line">    <span class="attr">dest</span>: <span class="string">'assets/app.js'</span>,</div><div class="line">    <span class="attr">sourceMap</span>: <span class="string">'inline'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Transpile to ES5</span></div><div class="line">js = babel(js, &#123;</div><div class="line">  <span class="attr">browserPolyfill</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">sourceMap</span>: <span class="string">'inline'</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy CSS file into assets</span></div><div class="line"><span class="keyword">const</span> css = compileSass(</div><div class="line">  [appRoot],</div><div class="line">  <span class="string">'styles/app.scss'</span>,</div><div class="line">  <span class="string">'assets/app.css'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">sourceMap</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapEmbed</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapContents</span>: <span class="literal">true</span>,</div><div class="line">  &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = merge([html, js, css]);</div></pre></td></tr></table></figure>
<p>Here are the changes:</p>
<ol>
<li>Removed the JS funnel, this is no longer needed</li>
<li>Now we pass <code>appRoot</code> to <code>Rollup</code>, pass it an input filter with <code>inputFiles</code> to include all JS files</li>
<li>Rollup is configured with an <code>entry</code> file, this is the first file that is <code>required</code>.</li>
<li>Define a destination for the resulting rolled up build, and enable sourceMaps.</li>
<li>Run this tree through babel to transpile to ES5</li>
</ol>
<p>Now <code>build &amp; serve</code> and notice that the <code>require()</code> error has gone, and it console logs out <code>foo</code>, all is<br>good in the world!</p>
<p>But wait, there’s more…</p>
<p>Whereas Browserify and Requirejs will wrap each module in a specialised function, rollup is more intelligent<br>and hoists modules up to first class citizens, producing the most efficient output.<br>Checkout <code>dist/assets/app.js</code>, you should see:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// dist/assets/app.js</span></div><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> foo = <span class="string">'foo'</span>;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(foo);</div></pre></td></tr></table></figure>
<p>As you can see, even though <code>app.js</code> imports <code>foo.js</code>, the compiled output contains no wrapping functions,<br>no extraneous code, just the value imported from <code>foo.js</code> and the <code>console.log()</code> statement. </p>
<p><strong> The audience gasps in amazement </strong></p>
<p>But wait, there’s more?</p>
<h3 id="Tree-shaking"><a href="#Tree-shaking" class="headerlink" title="Tree shaking"></a>Tree shaking</h3><p>This is not a euphamism, it’s an actual term that refers to removing dead/unused imported code.</p>
<p>Open <code>app/foo.js</code></p>
<p>Notice we’re also exporting a constant:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> bar = <span class="string">'bar'</span>;</div></pre></td></tr></table></figure>
<p>Open <code>app/app.js</code></p>
<p>Notice we’re importing this constant:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> bar <span class="keyword">from</span> <span class="string">'./foo'</span>;</div></pre></td></tr></table></figure>
<p>Now open <code>dist/assets/app.js</code>, notice how the <code>bar</code> is nowhere to be seen? What is this witchcraft?</p>
<p>This is part of the magic of Rollup, it knows, through static analysis, what code is not being used<br>and dynamically removes it. Cool huh?</p>
<h2 id="Live-Reload"><a href="#Live-Reload" class="headerlink" title="Live Reload"></a>Live Reload</h2><p>Well, obviously in dev we’d quite like to not have to hit refresh all the time, because developers are,<br>well, we’re lazy. So we can use a live reload server to do the job for us.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-livereload</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js - add this line to the top</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"><span class="keyword">const</span> compileSass = <span class="built_in">require</span>(<span class="string">'broccoli-sass-source-maps'</span>);</div><div class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line"><span class="keyword">const</span> Rollup = <span class="built_in">require</span>(<span class="string">'broccoli-rollup'</span>);</div><div class="line"><span class="keyword">const</span> LiveReload = <span class="built_in">require</span>(<span class="string">'broccoli-livereload'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Rollup dependencies</span></div><div class="line"><span class="keyword">let</span> js = <span class="keyword">new</span> Rollup(appRoot, &#123;</div><div class="line">  <span class="attr">inputFiles</span>: [<span class="string">'**/*.js'</span>],</div><div class="line">  <span class="attr">rollup</span>: &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'app.js'</span>,</div><div class="line">    <span class="attr">dest</span>: <span class="string">'assets/app.js'</span>,</div><div class="line">    <span class="attr">sourceMap</span>: <span class="string">'inline'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Transpile to ES5</span></div><div class="line">js = babel(js, &#123;</div><div class="line">  <span class="attr">browserPolyfill</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">sourceMap</span>: <span class="string">'inline'</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy CSS file into assets</span></div><div class="line"><span class="keyword">const</span> css = compileSass(</div><div class="line">  [appRoot],</div><div class="line">  <span class="string">'styles/app.scss'</span>,</div><div class="line">  <span class="string">'assets/app.css'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">sourceMap</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapEmbed</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapContents</span>: <span class="literal">true</span>,</div><div class="line">  &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">// Remove the existing module.exports and replace with:</span></div><div class="line"><span class="keyword">let</span> tree = merge([html, js, css]);</div><div class="line"></div><div class="line"><span class="comment">// Include live reaload server</span></div><div class="line">tree = <span class="keyword">new</span> LiveReload(tree, &#123;</div><div class="line">  <span class="attr">target</span>: <span class="string">'index.html'</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = tree;</div></pre></td></tr></table></figure>
<p>Now <code>build &amp; serve</code>, try changing a <code>scss</code> file, notice how the css refreshes in place, no browser<br>refresh. Change a <code>.js</code> or <code>.html</code> file and the page will refresh. This doesn’t support fancy hot<br>reloading like React and Webpack does, but that’s a slightly different ballgame, and I’m sure someone<br>clever will work that out.</p>
<h2 id="Environments"><a href="#Environments" class="headerlink" title="Environments"></a>Environments</h2><p>Environment configuration allows us to include or not include certain things in the build given certain<br>configuration options. For example, we probably want to not include live reload for production builds,<br>for this we need to have different environments. When building, we can provide an environment flag option.<br>So lets go ahead and configure things to support this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-env</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Brocfile.js</span></div><div class="line"><span class="keyword">const</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"><span class="keyword">const</span> compileSass = <span class="built_in">require</span>(<span class="string">'broccoli-sass-source-maps'</span>);</div><div class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line"><span class="keyword">const</span> Rollup = <span class="built_in">require</span>(<span class="string">'broccoli-rollup'</span>);</div><div class="line"><span class="keyword">const</span> LiveReload = <span class="built_in">require</span>(<span class="string">'broccoli-livereload'</span>);</div><div class="line"><span class="keyword">const</span> env = <span class="built_in">require</span>(<span class="string">'broccoli-env'</span>).getEnv();</div><div class="line"></div><div class="line"><span class="keyword">const</span> appRoot = <span class="string">'app'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Copy HTML file from app root to destination</span></div><div class="line"><span class="keyword">const</span> html = funnel(appRoot, &#123;</div><div class="line">  <span class="attr">files</span> : [<span class="string">'index.html'</span>],</div><div class="line">  <span class="attr">destDir</span> : <span class="string">'/'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Rollup dependencies</span></div><div class="line"><span class="keyword">let</span> js = <span class="keyword">new</span> Rollup(appRoot, &#123;</div><div class="line">  <span class="attr">inputFiles</span>: [<span class="string">'**/*.js'</span>],</div><div class="line">  <span class="attr">rollup</span>: &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'app.js'</span>,</div><div class="line">    <span class="attr">dest</span>: <span class="string">'assets/app.js'</span>,</div><div class="line">    <span class="attr">sourceMap</span>: <span class="string">'inline'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Transpile to ES5</span></div><div class="line">js = babel(js, &#123;</div><div class="line">  <span class="attr">browserPolyfill</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">sourceMap</span>: <span class="string">'inline'</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Copy CSS file into assets</span></div><div class="line"><span class="keyword">const</span> css = compileSass(</div><div class="line">  [appRoot],</div><div class="line">  <span class="string">'styles/app.scss'</span>,</div><div class="line">  <span class="string">'assets/app.css'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">sourceMap</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapEmbed</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">sourceMapContents</span>: <span class="literal">true</span>,</div><div class="line">  &#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">// Remove the existing module.exports and replace with:</span></div><div class="line"><span class="keyword">let</span> tree = merge([html, js, css]);</div><div class="line"></div><div class="line"><span class="comment">// Include live reaload server</span></div><div class="line"><span class="keyword">if</span> (env === <span class="string">'development'</span>) &#123;</div><div class="line">  tree = <span class="keyword">new</span> LiveReload(tree, &#123;</div><div class="line">    <span class="attr">target</span>: <span class="string">'index.html'</span>,</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = tree;</div></pre></td></tr></table></figure>
<p>What we’ve done here is wrapped the <code>LiveReload</code> section in an <code>env === &quot;development&quot;</code>, this ensures<br>the <code>LiveReload</code> tree is not included in the build when making a production build.</p>
<p>In order to pass in a different environment, simply add <code>BROCCOLI_ENV=production</code> before the build<br>command, e.g. <code>BROCCOLI_ENV=production broccoli build dist</code>. To make this simpler, lets add a new run<br>command in <code>package.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"build"</span>: <span class="string">"rm -rf dist &amp;&amp; broccoli build dist"</span>,</div><div class="line">    <span class="attr">"build-prod"</span>: <span class="string">"rm -rf dist &amp;&amp; BROCCOLI_ENV=production broccoli build dist"</span>,</div><div class="line">    <span class="attr">"serve"</span>: <span class="string">"broccoli serve"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now, running <code>npm run build-prod</code> will build in “production” mode.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Well that just about sums it up. As you can see, <code>Broccoli.js</code> is a pretty powerful tool, there are a<br>bunch of other cool filters and plugins for broccoli <a href="https://www.npmjs.com/search?q=broccoli-" target="_blank" rel="external">on npm</a>.<br>Mix and match, merge, concat, filter to your hearts content.</p>
<p>Hopefully this tutorial has helped you understand how to cook your vegetables.</p>
<p>Peace.</p>

      
    </div>
    
    <footer class="article-footer">
        If you notice any errors or things that need fixing in this article, please
        <a href="https://github.com/oligriffiths/oligriffiths.github.io/blob/content/_posts/Eat-your-greens-A-beginners-guide-to-Broccoli-js.md">
        submit a pull request against the article on Github
        </a>
    </footer>
    
    <footer class="article-footer">
      <a data-url="http://www.oligriffiths.com/2017/01/26/Eat-your-greens-A-beginners-guide-to-Broccoli-js/" data-id="cj3xb12ne00000mpfp2dj6c6q" class="article-share-link">Share</a>
      
        <a href="http://www.oligriffiths.com/2017/01/26/Eat-your-greens-A-beginners-guide-to-Broccoli-js/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/broccoli/">broccoli</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/06/30/namespacing-in-PHP-and-how-we-broke-it/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Namespacing in PHP and how we broke it</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
    var disqus_shortname = 'oligriffiths';
    
    var disqus_url = 'http://www.oligriffiths.com/2017/01/26/Eat-your-greens-A-beginners-guide-to-Broccoli-js/';
    
    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//go.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

</section>
            
              <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Architecture/">Architecture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Autoloading/">Autoloading</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design/">Design</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ember/">Ember</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HMVC/">HMVC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVC/">MVC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Namespaces/">Namespaces</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Terminal/">Terminal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blogging/">blogging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broccoli/">broccoli</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Architecture/" style="font-size: 10px;">Architecture</a> <a href="/tags/Autoloading/" style="font-size: 10px;">Autoloading</a> <a href="/tags/Design/" style="font-size: 10px;">Design</a> <a href="/tags/Ember/" style="font-size: 10px;">Ember</a> <a href="/tags/HMVC/" style="font-size: 10px;">HMVC</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/Namespaces/" style="font-size: 10px;">Namespaces</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/blogging/" style="font-size: 10px;">blogging</a> <a href="/tags/broccoli/" style="font-size: 10px;">broccoli</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/js/" style="font-size: 10px;">js</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/01/26/Eat-your-greens-A-beginners-guide-to-Broccoli-js/">Eat your greens! A beginners guide to Broccoli.js</a>
          </li>
        
          <li>
            <a href="/2015/06/30/namespacing-in-PHP-and-how-we-broke-it/">Namespacing in PHP and how we broke it</a>
          </li>
        
          <li>
            <a href="/2015/01/06/HMVC-and-why-you-should-use-it/">HMVC and why your web app needs it!</a>
          </li>
        
          <li>
            <a href="/2014/11/25/removing-http-from-web-apps/">Remove HTTP from your web apps</a>
          </li>
        
          <li>
            <a href="/2014/09/12/ember-first-experiences/">Ember - First Experiences</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
            
          </div>
        </div>
        <div id="footer_spacer"></div>
<footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
        All content copyright &copy; 2017 Oli Griffiths &bull; All rights reserved.<br>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/fastclick.js"></script>
<script type="text/javascript">
    $(function() {
        FastClick.attach(document.body);
    });
</script>
  </div>
</body>
</html>
